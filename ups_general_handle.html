<script> var mtoken = "1"; </script>

<!doctype html>

<html lang="tr">

<head>

    <meta charset="UTF-8">

    <title>Barkod Okuyucu Proje</title>
    <link rel="icon" href="img/logo.ico" type="image/x-icon" />
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>


    <!-- For sweet modal alert -->
    <link rel="stylesheet" href="https://cdn.modaselvim.net/swmodal/jquery.sweet-modal.min.css" />
    <script src="https://cdn.modaselvim.net/swmodal/jquery.sweet-modal.min.js"></script>

    <!--DATE RANGE FILTER-->

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.2/moment.min.js"></script>
    <script src="https://cdn.datatables.net/datetime/1.1.2/js/dataTables.dateTime.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/datetime/1.1.2/css/dataTables.dateTime.min.css">

    <style>

        header{
            margin-left: 5%;
            margin-right: 5%;
        }
        @media screen and (max-width: 768px) {
            header {
                margin-top: 380px;
            }
        }
        .card{
            border-style: none;
            border-radius: 10px;
        }
        body{
            font-family: Poppins;
        }
        #table{
            margin-top: 90px;
        }
        @media screen and (min-width: 300px) and (max-width: 768px) {
            #table{
                margin-top: 360px;
            }
        }
        div a {
            text-decoration: none;
            color: white;
            font-size: 16px;
            display:inline-block;

        }

        ul {
            display: inline;
            margin: 0;
            padding: 0;
        }
        ul li {
            display: inline-block;
        }
        ul li:hover {
            background:  #c20062;
            border-radius: 5px;
        }
        ul li:hover ul {display: block;}
        ul li ul {
            position: absolute;
            width: 200px;
            display: none;
        }
        ul li ul li {
            background: white;
            display: block;
        }
        ul li ul li a {display:block !important;}
        ul li ul li:hover {background:  white;}
        #m_tablex{
            border-style: none;

        }
        tfoot tr th{
            border-radius: 5px;
        }
        thead tr th{
            border-radius: 5px;
        }

        #m_tablex tr td{
            border-radius: 5px;
            user-select: all;
        }
        .scrollup {
            width: 40px;
            height: 40px;
            position: fixed;
            bottom: 50px;
            right: 100px;
            display: none;
            text-indent: -9999px;
            background: url('img/icon.png') no-repeat;
            border-radius: 5px;
            background-color: #a80055;
        }
        .btn btn-default buttons-excel buttons-html5{
            background-color: #a80055 ;
            color: #a80055;
        }
        .paginate_button previous disabled{
            background-color: peachpuff;
            color:palegreen;
        }
        .paginate_button active{
            background-color: peachpuff;
        }
    </style>

    <script>

        $(document).ready(function () {

            $(window).scroll(function () {
                if ($(this).scrollTop() > 100) {
                    $('.scrollup').fadeIn();
                } else {
                    $('.scrollup').fadeOut();
                } });
            $('.scrollup').click(function () {
                $("html, body").animate({
                    scrollTop: 0
                }, 100);
                return false;
            });

        });
    </script>

</head>

<body>

<link rel="stylesheet" type="text/css" href="https://kargo.modaselvim.net/css/datatables.min.css"/>
<script type="text/javascript" src="https://kargo.modaselvim.net/js/datatables.min.js"></script>

<nav class="navbar navbar-fixed-top" style="background-color:#a80055 ">
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="index.html">
                <img src="img/icon.png" style="width: 40px"  >
            </a>
        </div>
        <ul class="nav navbar-nav" >
            <li><a href="export.html" >İHRACAT</a></li>
            <li><a href="tipped.html"  >FİLTRELE</a></li>
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#"  >PTS
                    <span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="pts_handle.html">PTS İŞLE</a></li>
                    <li><a href="pts_general_handle.html">PTS GENEL İŞLE</a></li>
                    <li><a href="handled_pts.html">İŞLENDİ PTS</a></li>
                    <li><a href="pts_exit.html">PTS ÇIKIŞ</a></li>

                </ul>
            </li>
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">DHL
                    <span class="caret"></span></a>
                <ul class="dropdown-menu"  >
                    <li><a href="dhl_handle.html">DHL İŞLE</a></li>
                    <li><a href="dhl_general_handle.html">DHL GENEL İŞLE</a></li>
                    <li><a href="handled_dhl.html">İŞLENDİ DHL</a></li>
                </ul>
            </li>
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#"  >PTT
                    <span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="ptt_handle.html">PTT İŞLE</a></li>
                    <li><a href="ptt_general_handle.html">PTT GENEL İŞLE</a></li>
                    <li><a href="handled_ptt.html">İŞLENDİ PTT</a></li>
                </ul>
            </li>
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#" >UPS
                    <span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="ups_handle.html">UPS İŞLE</a></li>
                    <li><a href="ups_general_handle.html">UPS GENEL İŞLE</a></li>
                    <li><a href="handled_ups.html">İŞLENDİ UPS</a></li>
                    <li><a href="ups_exit.html">UPS ÇIKIŞ</a></li>

                </ul>
            </li>

        </ul>
        <ul class="nav navbar-nav navbar-right">
            <li><a href="#"><span class="glyphicon glyphicon-user"></span> KULLANICI</a></li>
            <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> ÇIKIŞ</a></li>
        </ul>
    </div>
</nav>


<header>
    <div class="row" id="table">
        <div class="col-md-12 col-lg-12 mt-0 ">
            <div class="card">
                <div class="card-header" style="background-color: white;height: 35px">
                    <h3 class="card-title  " style="color:#a80055;text-align: center;font-weight: bold">UPS GENEL İŞLE </h3>
                </div>
                <div class="card-body"  >
                    <div class="table-responsive">
                        <table border="0" cellspacing="5" cellpadding="5">
                            <tbody><tr>

                                <td><input type="text" id="min" name="min" class="fa fa-calendar-o" placeholder="gg.aa.yyyy" style="border-color: #a80055;border-radius: 5px;margin: 5px"><img src="img/calendar.png" style="width: 20px"></td>

                                <td><input type="text" id="max" name="max" placeholder="gg.aa.yyyy" style="border-color: #a80055;border-radius: 5px;margin: 5px"><img src="img/calendar.png" style="width: 20px"  ></td>

                            </tr>

                            </tbody></table>
                        <table class="table table-striped table-hover table-bordered text-nowrap w-100" id="m_tablex" style=" border-radius: 5px">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Kullanıcı</th>
                                <th>Sipariş No</th>
                                <th>Tarih</th>
                                <th>Takip No</th>
                                <th>Yazdır</th>
                                <th>Kargo</th>
                                <th>Tekrar</th>
                                <th>Ülke</th>
                                <th>Müşteri</th>
                                <th>Tutar</th>
                                <th>Not</th>
                                <th>Tsoft</th>
                                <th>Av. Ülkesi</th>
                            </tr>
                            </thead>

                            <tfoot>
                            <tr>
                                <th>ID</th>
                                <th>Kullanıcı</th>
                                <th>Sipariş No</th>
                                <th>Tarih</th>
                                <th>Takip No</th>
                                <th>Yazdır</th>
                                <th>Kargo</th>
                                <th>Tekrar</th>
                                <th>Ülke</th>
                                <th>Müşteri</th>
                                <th>Tutar</th>
                                <th>Not</th>
                                <th>Tsoft</th>
                                <th>Av. Ülkesi</th>
                            </tr>
                            </tfoot>
                            <tbody id="example_tbody">

                            </tbody>
                        </table>

                    </div>
                </div>
                <!-- TABLE WRAPPER -->
            </div>
            <!-- SECTION WRAPPER -->
        </div>
    </div>
    <!-- ROW-2 CLOSED -->

</header>
<article style="height: 100px">

    <a href="#" class="scrollup">Scroll</a>

</article>
<footer class="footer">
    <div class="jumbotron" style="background-color: #a80055 ;margin-bottom:0px;height: 0px">
        <div class="row align-items-center flex-row-reverse">
            <div class="col-md-12  col-sm-12  text-center " style="color: white">
                Copyright © 2021 <a href="#" style="color: #d1bd2d;text-decoration: none">Moda Selvim</a> <a href="#"></a> All rights reserved.
            </div>
        </div>
    </div>
</footer>


<script>
    $(document).ready(function () {
        var minDate, maxDate;

        // Custom filtering function which will search data in column three between two values
        $.fn.dataTable.ext.search.push(
            function( settings, data, dataIndex ) {
                var min = minDate.val();
                var max = maxDate.val();
                var date = new Date(data[3]);

                if (
                    ( min === null && max === null ) ||
                    ( min === null && date <= max ) ||
                    ( min <= date   && max === null ) ||
                    ( min <= date   && date <= max )
                )
                {
                    return true;
                }
                return false;
            }
        );
        // Create date inputs
        minDate = new DateTime($('#min'), {
            dateFormat: 'dd-mm-yyyy',
            language:'tr',

            monthNames: [ "Ocak", "Şubat", "Mart", "Nisan", "Mayıs", "Haziran", "Temmuz", "Ağustos", "Eylül", "Ekim", "Kasım", "Aralık" ],
            dayNamesMin: [ "Pa", "Pt", "Sl", "Ça", "Pe", "Cu", "Ct" ],
        });
        maxDate = new DateTime($('#max'), {
            dateFormat: 'dd-mm-yyyy',
            language: 'tr',

            monthNames: [ "Ocak", "Şubat", "Mart", "Nisan", "Mayıs", "Haziran", "Temmuz", "Ağustos", "Eylül", "Ekim", "Kasım", "Aralık" ],
            dayNamesMin: [ "Pa", "Pt", "Sl", "Ça", "Pe", "Cu", "Ct" ],
        });


        var r = /^[0-9]{10}$/;

        $('.firma').on('change', function() {

            r = /^[0-9]{1}[A-Z]{1}/;
            var firma = this.value;
            if (firma == 'dhl') {
                r = /^[0-9]{10}$/;
            } else if (firma == 'ups') {
                r = /^[0-9]{1}[A-Z]{1}/;
            } else if (firma == 'aramex') {
                r = /^[0-9]{11}$/;
            } else if (firma == 'pts') {
                r = /^[0-9]{10}$/;
            }
            console.log(firma + '-' + r);
        });

        var sayVeri = '';
        $(".tsmi").on("input", function() {
            var self = $(this);


            if (self.val().match(r) !== null) {
                sayVeri = self.val()
            } else {

                self.val("");
                //self.val(sayVeri);
            }
        });
        $.ajax({
            url: "http://kargokontrol.modaselvim.net:4554/api/v1/ydKargo/isListe",
            method: "POST",
            timeout: 0,
            headers: {
                "Content-Type": "application/json"
            },
            data: JSON.stringify({
                "token": "5cf9f7597d144ad4e47c61ff3d5031d1",
                "startDate": "2022-08-30",
                "endDate": "2022-09-20",
                "type": [
                    0,
                    1
                ],
                cargo: "ups",
            }),

            success: function (response) {

                $("#example_tbody").empty();

                var len = response.data.length;
                for (var i = 0; i < len; i++) {

                    var BarcodeUrl =  response.data[i].BarcodeUrl;
                    var AwbUrl = response.data[i].AwbUrl;
                    var id = response.data[i].id;
                    var TS = response.data[i].TS;
                    var cikis_tarih=response.data[i].cikis_tarih;
                    var tarihg = response.data[i].tarihg;
                    var takipno = response.data[i].takipno;
                    var DeliveryCountry = response.data[i].DeliveryCountry;
                    var OrderTotalPrice = Math.round(response.data[i].OrderTotalPrice);
                    var Currency = response.data[i].Currency;
                    var DeliveryName=response.data[i].DeliveryName;

                    var username=response.data[i].username ;
                    if(username == "rafiye.can") {
                        $(".user").css("background-color", "#FF0070");
                    }
                    else if(username == "mirackubra.keles") {
                        $(".user").css("background-color", "#FF8600");
                    }

                    else{}

                    var tekrar = response.data[i].tekrar;

                     if(tekrar == "1"){
                        $(".tekrarcell").css("background-color", "#AFA070");
                    }
                    else if(tekrar == "2"){
                        $(".tekrarcell").css("background-color", "#BB6060");
                    }
                    else if (tekrar== "3"){
                        $(".tekrarcell").css("background-color", "#CC7CC7");
                     }
                    else{}

                    var row =

                        "<tr>" +
                        "<td >" + id + "</td>" +
                        "<td class='user'>" + username + "</td>" +
                        "<td>" + TS + "</td>" +
                        "<td>" + cikis_tarih + "</td>" +
                        "<td>" + `<table id='input'>
                                  <tbody>
                                           <tr>
                                           <td><input class="tsmi" type="text" style='width: 200px ;height: 30px;border-radius: 5px' name="takip" value=`+ takipno +`  required>
                                            <select size="1" id="row-1-office" class="firma" name="firma" style='width: 90px;border-radius: 5px'>
                                            <option value="Edinburgh" selected="selected">KARGO</option>
                                            <option value="pts">PTS</option>
                                            <option value="dhl">DHL</option>
                                            <option value="ptt">PTT</option>
                                            <option value="ups">UPS</option>
                                            </select>

                                            <select size="1" id="row-1-office" name="row-1-office" style='width: 90px;border-radius: 5px'>
                                            <option value="Edinburgh" selected="selected">İHRACAT</option>
                                            <option value="ihracat">İhracat</option>
                                            <option value="ihracatDegil">Değil</option>
                                            </select>

                                          <select size="1" id="row-1-office" name="post_packet" style='width: 90px;border-radius: 5px'>
                                            <option value="Edinburgh" selected="selected">PAKET</option>
                                            <option value="">Poşet</option>
                                            <option value=" ">KOLİ</option>
                                            <option value=" ">KOLİ 4</option>
                                            <option value=" ">KOLİ 5</option>
                                            <option value=" ">KOLİ 6</option>
                                            <option value=" ">KOLİ 7</option>
                                            <option value=" ">KOLİ 8</option>
                                            </select>
                                              <input type='submit' name='degis'value='İşlendi' style='background-color: #a80055;color: white;border-style: none;border-radius: 5px'>
                                            </td>
                                            </tr>
                                            </table>
` + "</td>" +
                        "<td>" + "<a id='submit' href='https://kargo.modaselvim.net/fatura.php?ts="+ TS +"'  class='btn' style='background-color: #a80055;color: white;border-style: none;border-radius: 5px'>Yazdır</a> "   + "</td>" +
                        "<td>" + "<a href='"+ BarcodeUrl +"' class='btn' style='background-color: #a80055;color: white;border-style: none;border-radius: 5px' > Barkod </a> " + "<a href='"+ AwbUrl +"' class='btn' style='background-color: #a80055;color: white;border-style: none;border-radius: 5px' >Awb</a> " + "  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"23\" height=\"23\" color=\"#a80055\"fill=\"currentColor\" class=\"bi bi-truck\" viewBox=\"0 0 16 16\">" +
                        "                                        <path d=\"M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-3.998-.085A1.5 1.5 0 0 1 0 10.5v-7zm1.294 7.456A1.999 1.999 0 0 1 4.732 11h5.536a2.01 2.01 0 0 1 .732-.732V3.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .294.456zM12 10a2 2 0 0 1 1.732 1h.768a.5.5 0 0 0 .5-.5V8.35a.5.5 0 0 0-.11-.312l-1.48-1.85A.5.5 0 0 0 13.02 6H12v4zm-9 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm9 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2z\"/>\n" +
                        "                                    </svg>" + "</td>" +
                        "<td  class='tekrarcell'>"+ tekrar + "</td>" +
                        "<td >" + DeliveryCountry+ "</td>" +
                        "<td>" + DeliveryName + "</td>" +
                        "<td>" + OrderTotalPrice +"<br>"+ Currency +  "</td>" +
                        "<td>" + "<a href='https://www.modaselvim.com/srv/admin/order/order/detail/"+ TS +"/1#order-notes '   class='btn btn-warning'>T-SOFT</a> " + "</td>" +
                        "<td>" + "<a href='#not' onclick=' $.getNotesFromRest()' class='btn' style='background-color: #a80055;color: white;border-style: none;border-radius: 5px' >NOTLAR</a> " + "</td>" +
                        "<td>" +  + "</td>" +
                        "</tr>" ;
                        $("#example_tbody").append(row);
                }

                console.log(response);
                var table = $( "#m_tablex" ).DataTable({
                    scrollX: true,
                    language: {
                        "url": "//cdn.datatables.net/plug-ins/1.10.16/i18n/Turkish.json",
                        "buttons": {
                            "pageLength": {
                                "_": "Sayfada %d kayıt göster",
                                "-1": "Tümünü göster" // « This will not work in JS, right?
                            },
                            "selectAll": "Tümünü Seç",
                            "selectNone": "Tümünü Kaldır"
                        },
                        "select": {
                            "rows": {
                                "_": "%d Satır seçildi.",
                                "0": "Seçmek için bir satıra tıklayın.",
                                "1": "1 Satır seçildi."
                            }
                        }
                    },
                    dom: "Bfrtip",
                    "lengthMenu": [
                        [10, 25, 50, 100, 500, -1],
                        ["10", "25", "50", "100", "500", "Tümü"]
                    ],
                    paging: true,
                    order: [[0, "desc"]],
                    buttons: [

                        "pageLength", {
                            extend: 'excel',
                            title: 'Kullanıcı Detay YurtDışı'
                        }
                    ],

                "initComplete": function () {
                        this.api().column(1).every(function () {
                            var column = this;
                            var select = $('<select><option value=""></option></select>')
                                .appendTo($(column.footer()).empty())
                                .on('change', function () {
                                    var val = $.fn.dataTable.util.escapeRegex(
                                        $(this).val()
                                    );
                                    column
                                        .search(val ? '^' + val + '$' : '', true, false)
                                        .draw();
                                });

                            column.data().unique().sort().each(function (d, j) {
                                select.append('<option value="' + d + '">' + d + '</option>')
                            });
                        });
                    },
                    "footerCallback": function (row, data, start, end, display) {
                        var api = this.api(), data;

                        // Remove the formatting to get integer data for summation
                        var intVal = function (i) {
                            return typeof i === 'string' ?
                                i.replace(/[\$,]/g, '') * 1 :
                                typeof i === 'number' ?
                                    i : 0;
                        };
                        // Total over this page
                        pageTotal = api
                            .column(1, {page: 'current'})
                            .data()
                            .reduce(function (a, b) {
                                return intVal(a) + intVal(b);
                            }, 0);
                    },

                });

                $('#min, #max').on('change', function () {
                    table.draw();
                });
            }

        });

        $.getNotesFromRest = function(TS) {
            $.spinAktif();
            $.ajax({
                url: 'https://api.reaktif.live/order2/getOrderNote',
                type: 'post',
                data: {
                    "token": mtoken,
                    "OrderCode": TS
                },
                headers: {
                    'Accept': 'json'
                },
                dataType: 'json',
                success: function(resp) {
                    $.spinPasif();
                    if (resp.success) {

                        var tb1 = `
						<p style="text-align:left">Kullanıcı Notları</p>
						<table class="table table-striped table-hover table-bordered tbl_notes" style="font-size:12px;float:left; text-align:left">
								<thead>
									<tr style="background-color:#ccc">
									<th class ="col-md-2">Ekleyen</th>
									<th class ="col-md-10">Not</th>
									</tr>
								</thead>
								<tbody>
					`;

                        var tb2 = `
						<p style="text-align:left">Sistem Logları</p>
						<table class="table table-striped table-hover table-bordered tbl_notes" style="font-size:12px;float:left; text-align:left">
								<thead>
									<tr style="background-color:#ccc">
									<th class ="col-md-2">Ekleyen</th>
									<th class ="col-md-10">Not</th>
									</tr>
								</thead>
								<tbody>
					`;
                        //var appText ='<pre style="text-align : left; width:600px; overflow:auto">';
                        var appText = '';
                        var appText2 = '';
                        var notes = resp.data;

                        notes.sort(function(a, b) {
                            return Number(b.RecordTime) - Number(a.RecordTime)
                        });

                        for (i in notes) {
                            var obj = notes[i];
                            if (obj.IsNote == "1") {
                                appText += `
								<tr>
									<td>${ $.timeToString(obj.RecordTime) }<br>${obj.AdminName}</td>
									<td>${obj.Text}</td>
								</tr>
							`;
                            } else {
                                appText2 += `
								<tr>
									<td>${ $.timeToString(obj.RecordTime) }<br>${obj.AdminName}</td>
									<td>${obj.Text}</td>
								</tr>
							`;
                            }

                        }

                        tb1 += appText + '</tbody></table>';
                        tb2 += appText2 + '</tbody></table>';

                        $.sweetModal(tb1 + tb2);
                    } else {
                        $.sweetModal('Sipariş bulunamadı, arşivde olabilir. <br><br> Hata Mesajı : ' + resp
                            .message[0].text[0]);
                    }
                }, //success
                error: function(xhr) {
                    $.spinPasif();
                    $.sweetModal("xhr hatası.." + xhr.responseText);
                }
            });

        }



        $.timeToString=function(time){
            if(time == 0 || time == "null" || time == null) return "-";
            var time=Number(time)*1000;
            var tarih = new Date(time);
            var gun = tarih.getDate();
            var ay  = tarih.getMonth() + 1;
            var yil = tarih.getFullYear();

            var saat = tarih.getHours();
            var dakika = tarih.getMinutes();
            var saniye = tarih.getSeconds();

            if(gun<10) gun="0"+gun;
            if(ay<10) ay="0"+ay;

            if(saat<10) saat="0"+saat;
            if(dakika<10) dakika="0"+dakika;
            if(saniye<10) saniye="0"+saniye;

            // var zaman = gun+'-'+ay+'-'+yil+' '+saat+':'+dakika+':'+saniye;
            var zaman = yil+'-'+ay+'-'+gun+' '+saat+':'+dakika+':'+saniye;

            return zaman;
        }

        $.spinAktif = function() {
            $("#spinner_bg").removeClass("hide_this");
            $("#spinner").removeClass("hide_this");
        }

        $.spinPasif = function() {
            $("#spinner_bg").addClass("hide_this");
            $("#spinner").addClass("hide_this");
        }

    });
</script>

</body>

</html>