<script> var mtoken = "1"; </script>

<!doctype html>

<html lang="tr">

<head>

    <meta charset="UTF-8">

    <title>Barkod Okuyucu Proje</title>
    <link rel="icon" href="img/logo.ico" type="image/x-icon" />
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css" />
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/locales/bootstrap-datepicker.tr.min.js"></script>
    <!-- For sweet modal alert -->
    <link rel="stylesheet" href="https://cdn.modaselvim.net/swmodal/jquery.sweet-modal.min.css" />
    <script src="https://cdn.modaselvim.net/swmodal/jquery.sweet-modal.min.js"></script>






    <!-- DATETIMEPICKER -->

    <script src="https://kit.fontawesome.com/7059aa82dd.js" crossorigin="anonymous"></script>

    <!-- for DATE PICKER -->

    <link href="lib/bootstrap-datepicker.min.css" rel="stylesheet">

    <script src="lib/bootstrap-datepicker.min.js" type="text/javascript"></script>

    <script src="lib/bootstrap-datepicker.tr.min.js" type="text/javascript"></script>


    <style>

        header{
            margin-top:  80px;
            margin-left: 5%;
            margin-right: 5%;
        }

        .card{
            border-style: none;
            border-radius: 10px;
        }
        body{
            font-family: Poppins;
        }
        #table{
            margin-top: 60px;
        }
        @media screen and (min-width: 300px) and (max-width: 768px) {
            header {
                margin-top: 370px;
            }
        }
        div a {
            text-decoration: none;
            color: white;
            font-size: 16px;
            display:inline-block;

        }
        ul {
            display: inline;
            margin: 0;
            padding: 0;
        }
        ul li {
            display: inline-block;
        }
        ul li:hover {
            background:  #c20062;
            border-radius: 5px;
        }
        ul li:hover ul {display: block;}
        ul li ul {
            position: absolute;
            width: 200px;
            display: none;
        }
        ul li ul li {
            background: white;
            display: block;
        }
        ul li ul li a {display:block !important;}
        ul li ul li:hover {background:  white;}
        #m_tablex{
            border-style: none;
            border-radius: 5px;

        }
        #m_tablex tr th{
            border-radius: 5px;
            margin-top: 30px;
        }
        #m_tablex tr td{
            border-radius: 5px;
            user-select: all;
        }
        .scrollup {
            width: 40px;
            height: 40px;
            position: fixed;
            bottom: 50px;
            right: 100px;
            display: none;
            text-indent: -9999px;
            background: url('img/icon.png') no-repeat;
            border-radius: 5px;
            background-color: #a80055;
        }
        .btn btn-default buttons-excel buttons-html5{
            background-color: #a80055 ;
            color: #a80055;
        }
        .paginate_button previous disabled{
            background-color: peachpuff;
            color:palegreen;
        }
        .paginate_button active{
            background-color: peachpuff;
        }
    </style>
</head>
<body>

<link rel="stylesheet" type="text/css" href="https://kargo.modaselvim.net/css/datatables.min.css"/>
<script type="text/javascript" src="https://kargo.modaselvim.net/js/datatables.min.js"></script>

<nav class="navbar navbar-fixed-top" style="background-color:#a80055">
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="index.html">
                <img src="img/icon.png" style="width: 40px"  >
            </a>
        </div>
        <ul class="nav navbar-nav" >
            <li><a href="#" >İHRACAT</a></li>
            <li><a href="#"  >FİLTRELE</a></li>
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#"  >PTS
                    <span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="pts_handle.html">PTS İŞLE</a></li>
                    <li><a href="pts_general_handle.html">PTS GENEL İŞLE</a></li>
                    <li><a href="handled_pts.html">İŞLENDİ PTS</a></li>
                    <li><a href="pts_exit.html">PTS ÇIKIŞ</a></li>

                </ul>
            </li>
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">DHL
                    <span class="caret"></span></a>
                <ul class="dropdown-menu"  >
                    <li><a href="dhl_handle.html">DHL İŞLE</a></li>
                    <li><a href="dhl_general_handled.html">DHL GENEL İŞLE</a></li>
                    <li><a href="handled_dhl.html">İŞLENDİ DHL</a></li>
                </ul>
            </li>
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#"  >PTT
                    <span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="ptt_handle.html">PTT İŞLE</a></li>
                    <li><a href="ptt_general_handle.html">PTT GENEL İŞLE</a></li>
                    <li><a href="handled_ptt.html">İŞLENDİ PTT</a></li>
                </ul>
            </li>
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#" >UPS
                    <span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="ups_handle.html">UPS İŞLE</a></li>
                    <li><a href="ups_general_handle.html">UPS GENEL İŞLE</a></li>
                    <li><a href="handled_ups.html">İŞLENDİ UPS</a></li>
                    <li><a href="ups_exit.html">UPS ÇIKIŞ</a></li>

                </ul>
            </li>

        </ul>
        <ul class="nav navbar-nav navbar-right">
            <li><a href="#"><span class="glyphicon glyphicon-user"></span> KULLANICI</a></li>
            <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> ÇIKIŞ</a></li>
        </ul>
    </div>
</nav>

<header>

    <!-- ROW OPEN -->
    <div class="card-header" style="background-color: white;height: 35px;">
        <h3 class="card-title  " style="color:#a80055;text-align: center;font-weight: bold">FİLTRELENENLER</h3>
    </div>

    <div class="form-group" >
        <form class="navbar-form navbar-left" role="search" method="post">
            <input required="" type="date" class="form-control "  id="startDate" name="startDate" min="01.01.2017">
            <input required="" type="date" class="form-control mt-2" id="endDate" name="endDate" min="01.01.2017">
            <select class="form-control mt-2" name="firma">
                <option value="aramex">TÜM KARGOLAR</option>
                <option value="dhl">DHL</option>
                <option value="pts">PTS</option>
                <option value="ptt">PTT</option>
                <option value="ups">UPS</option>
            </select>
            <button type="submit" class="btn btn-default  mt-2" name="tipped" style="background-color:#a80055;color:white" >GETİR</button>
        </form>
    </div>
    <!-- ROW CLOSE -->

    <div class="row" id="table">
        <div class="col-md-12 col-lg-12 mt-0 ">
            <div class="card">

                <div class="card-body"  >
                    <div class="table-responsive">
                        <table class="table table-striped table-hover table-bordered text-nowrap w-100" id="m_tablex"  >
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Kullanıcı</th>
                                <th>Çıkış Tarihi</th>
                                <th>Sipariş No</th>
                                <th>Tarih</th>
                                <th>Firma</th>
                                <th>Takip No</th>
                                <th>Durum</th>
                                <th>Tekrar</th>
                                <th>Tekrar Tarih</th>
                                <th>E-Arşiv</th>
                                <th>Teslim Tarihi</th>
                                <th>EGTB</th>
                                <th>Ülke</th>
                                <th>Tutar</th>
                                <th>Paket</th>
                                <th>Av. Ülkesi</th>
                                <th>Not</th>

                            </tr>
                            </thead>
                            <tfoot>
                            <tr>
                                <th>ID</th>
                                <th>Kullanıcı</th>
                                <th>Çıkış Tarihi</th>
                                <th>Sipariş No</th>
                                <th>Tarih</th>
                                <th>Firma</th>
                                <th>Takip No</th>
                                <th>Durum</th>
                                <th>Tekrar</th>
                                <th>Tekrar Tarih</th>
                                <th>E-Arşiv</th>
                                <th>Teslim Tarihi</th>
                                <th>EGTB</th>
                                <th>Ülke</th>
                                <th>Tutar</th>
                                <th>Paket</th>
                                <th>Av. Ülkesi</th>
                                <th>Not</th>
                            </tr>
                            </tfoot>
                            <tbody id="example_tbody">
                            </tbody>
                        </table>

                    </div>
                </div>
                <!-- TABLE WRAPPER -->
            </div>
            <!-- SECTION WRAPPER -->
        </div>
    </div>
    <!-- ROW-2 CLOSED -->

</header>
<article style="height: 100px">

    <a href="#" class="scrollup">Scroll</a>

</article>
<footer class="footer">
    <div class="jumbotron" style="background-color: #a80055 ;margin-bottom:0px;height: 0px">
        <div class="row align-items-center flex-row-reverse">
            <div class="col-md-12  col-sm-12  text-center " style="color: white">
                Copyright © 2021 <a href="#" style="color: #d1bd2d;text-decoration: none">Moda Selvim</a> <a href="#"></a> All rights reserved.
            </div>
        </div>
    </div>
</footer>

<script>


    $(document).ready(function () {
        var minDate,maxDate;

        $.fn.dataTable.ext.search.push(
            function(settings,data,dataIndex){
                var startDate = minDate.val();
                var endDate = maxDate.val();
                var date =new Date(data[3]);

                if(
                    (startDate === null && endDate ===null)||(startDate === null && date<=endDate)(startDate<=date && endDate===null) || (startDate<=date && date <= endDate)
                )
                {return true}
                return false;

            }

        );
        $("#startDate").focusin(function () {
            $(this).datepicker({
                format: "yyyy-mm-dd",
                todayHighlight: true,
                autoclose: true,
                language: "tr",
                todayBtn: "linked",
            });
        });

        $("#endDate").focusin(function () {
            $(this).datepicker({
                format: "yyyy-mm-dd",
                todayHighlight: true,
                autoclose: true,
                language: "tr",
                todayBtn: "linked",
            });
        });
        $.ajax({
            url: "http://kargokontrol.modaselvim.net:4554/api/v1/ydKargo/isListe",
            method: "POST",
            timeout: 0,
            headers: {
                "Content-Type": "application/json"
            },
            data: JSON.stringify({
                "token": "b492e8ed3f21712c550268b83505c1f2",
                "startDate": "2022-08-30",
                "endDate": "2022-08-30",
                "type": [
                    0,
                    1
                ],
                "cargo": "ptt"

            }),
            success: function (response) {

                $("#example_tbody").empty();

                var len = response.data.length;
                for (var i = 0; i < len; i++) {
                    var id = response.data[i].id;
                    var username=response.data[i].username;
                    var cikis_tarih=response.data[i].cikis_tarih;
                    var TS = response.data[i].TS;
                    var tarih = response.data[i].tarih;
                    var Cargo = response.data[i].Cargo;
                    var takipno = response.data[i].takipno;
                    var durum = response.data[i].durum;
                    var tekrar = response.data[i].tekrar;
                    var tarihg = response.data[i].tarihg;
                    var DeliveryCountry = response.data[i].DeliveryCountry;
                    var OrderTotalPrice = Math.round(response.data[i].OrderTotalPrice);
                    var Currency = response.data[i].Currency;
                    var post_packet =response.data[i].post_packet;
                    var etgb = response.data[i].etgb;

                    var row =
                        "<tr>" +
                        "<td>" + id + "</td>" +
                        "<td>" + username + "</td>" +
                        "<td>" + cikis_tarih + "</td>" +
                        "<td>" + TS + "</td>" +
                        "<td>" + tarih + "</td>" +
                        "<td>" + Cargo + "</td>" +
                        "<td>" + takipno +"</td>" +
                        "<td>" + durum +"</td>" +
                        "<td>" + tekrar + "</td>" +
                        "<td>" + tarihg +"</td>"  +
                        "<td>" + "<a href='#not'   class='btn btn-warning' >NOTLAR</a> " + "</td>" +
                        "<td>" + tarihg+ "</td>" +
                        "<td>" + etgb + "</td>"  +
                        "<td>" + DeliveryCountry + "</td>" +
                        "<td>" + OrderTotalPrice +"<br>"+ Currency +  "</td>" +
                        "<td>" + post_packet + "</td>" +
                        "<td>" +  + "</td>" +
                        "<td>" + "<a href='#not' onclick=' $.getNotesFromRest()' class='btn btn-warning' >NOTLAR</a> " + "</td>" +
                        "</tr>" ;
                    $("#example_tbody").append(row);
                }

                console.log(response);
                var table= $( "#m_tablex" ).DataTable({
                    scrollX: true,
                    language: {
                        "url": "//cdn.datatables.net/plug-ins/1.10.16/i18n/Turkish.json",
                        "buttons": {
                            "pageLength": {
                                "_": "Sayfada %d kayıt göster",
                                "-1": "Tümünü göster" // « This will not work in JS, right?
                            },
                            "selectAll": "Tümünü Seç",
                            "selectNone": "Tümünü Kaldır"
                        },
                        "select": {
                            "rows": {
                                "_": "%d Satır seçildi.",
                                "0": "Seçmek için bir satıra tıklayın.",
                                "1": "1 Satır seçildi."
                            }
                        }
                    },
                    dom: "Bfrtip",
                    "lengthMenu": [
                        [15, 25, 50, 100, 500, -1],
                        ["15", "25", "50", "100", "500", "Tümü"]
                    ],
                    paging: true,
                    order: [[0, "desc"]],
                    buttons: [
                        "pageLength", {
                            extend: 'excel',
                            title: 'Kullanıcı Detay YurtDışı'
                        }
                    ],

                    initComplete: function () {
                        this.api().column(1).every(function () {
                            var column = this;
                            var select = $('<select><option value=""></option></select>')
                                .appendTo($(column.footer()).empty())
                                .on('change', function () {
                                    var val = $.fn.dataTable.util.escapeRegex(
                                        $(this).val()
                                    );
                                    column
                                        .search(val ? '^' + val + '$' : '', true, false)
                                        .draw();
                                });

                            column.data().unique().sort().each(function (d, j) {
                                select.append('<option value="' + d + '">' + d + '</option>')
                            });
                        });
                    },
                    "footerCallback": function (row, data, start, end, display) {
                        var api = this.api(), data;

                        // Remove the formatting to get integer data for summation
                        var intVal = function (i) {
                            return typeof i === 'string' ?
                                i.replace(/[\$,]/g, '') * 1 :
                                typeof i === 'number' ?
                                    i : 0;
                        };
                        // Total over this page
                        pageTotal = api
                            .column(1, {page: 'current'})
                            .data()
                            .reduce(function (a, b) {
                                return intVal(a) + intVal(b);
                            }, 0);
                    }
                });
            }
        });
        new $.fn.dataTable.Buttons(table, {
            buttons: [
                {
                    extend: 'colvis',
                    text: 'Show/Hide Columns'

                },

            ]
        });

        //add button to top
        table.buttons(0, null).container().prependTo(
            table.table().container()
        );


        //remove class from search filter
        ($("#mytable_filter input").removeClass("input-sm"));





        //instantiate datepicker and choose your format of the dates
        $('.daterange').daterangepicker({
            ranges: {
                "Today": [moment(), moment()],
                'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                '7 last days': [moment().subtract(6, 'days'), moment()],
                '30 last days': [moment().subtract(29, 'days'), moment()],
                'This month': [moment().startOf('month'), moment().endOf('month')],
                'Last month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
            },
            autoUpdateInput: false,
            opens:"left",
            locale: {
                cancelLabel: 'Clear',
                format: 'DD-MMM-YYYY'
            }
        });


        // $.fn.dataTableExt.afnFiltering = new Array();

        //get column index for date range
        var visiblecolumnIndex;
        var dataColumnIndex;  //current data column to work with

        $("#mytable_wrapper thead").on("mousedown", "th", function (event) {
            visiblecolumnIndex = $(this).parent().children().index($(this));
            dataColumnIndex = $("tr:first-child").children(':eq(' + visiblecolumnIndex + ')').attr('data-column-index');

        });

        var startDate;
        var endDate;

        var DateFilterFunction = (function (settings, data, iDataIndex) {

            var filterstart = startDate;
            var filterend = endDate;
            var iStartDateCol = dataColumnIndex;
            var iEndDateCol = dataColumnIndex;

            var tabledatestart = data[iStartDateCol] !== "" ? moment(data[iStartDateCol], "DD-MMM-YYYY") : data[iStartDateCol];
            var tabledateend = data[iEndDateCol] !== "" ? moment(data[iEndDateCol], "DD-MMM-YYYY") : data[iEndDateCol];



            if (filterstart === "" && filterend === "") {
                return true;
            }

            else if ((moment(filterstart, "DD-MMM-YYYY").isSame(tabledatestart) || moment(filterstart, "DD-MMM-YYYY").isBefore(tabledatestart)) && filterend === "") {
                return true;
            }
            else if ((moment(filterstart, "DD-MMM-YYYY").isSame(tabledatestart) || moment(filterstart, "DD-MMM-YYYY").isAfter(tabledatestart)) && filterstart === "") {
                return true;
            }
            else if ((moment(filterstart, "DD-MMM-YYYY").isSame(tabledatestart) || moment(filterstart, "DD-MMM-YYYY").isBefore(tabledatestart)) && (moment(filterend, "DD-MMM-YYYY").isSame(tabledateend) || moment(filterend, "DD-MMM-YYYY").isAfter(tabledateend))) {
                return true;
            }

            return false;


        });

        $(".daterange", this).on('apply.daterangepicker', function (ev, picker) {
            ev.preventDefault();
            $(this).val(picker.startDate.format('DD-MMM-YYYY') + ' to ' + picker.endDate.format('DD-MMM-YYYY'));
            startDate = picker.startDate.format('DD-MMM-YYYY');
            endDate = picker.endDate.format('DD-MMM-YYYY');
            $.fn.dataTableExt.afnFiltering.push(DateFilterFunction);

            table.draw();

        });

        $(".daterange", this).on('cancel.daterangepicker', function (ev, picker) {
            ev.preventDefault();
            $(this).val('');
            startDate = '';
            endDate = '';
            $.fn.dataTableExt.afnFiltering.push(DateFilterFunction);
            table.draw();
        });

        //hide unnecessary columns
        var column = table.columns($('.HideColumn'));
        // Toggle the visibility
        column.visible(!column.visible());

        // Apply the search
        $.each($('.input-filter', table.table().header()), function () {
            var column = table.column($(this).index());
            //onsole.log(column);
            $('input', this).on('keyup change', function () {
                if (column.search() !== this.value) {
                    column
                        .search(this.value)
                        .draw();
                }
            });
        });





    });
    $.getNotesFromRest = function(TS) {
        $.spinAktif();
        $.ajax({
            url: 'https://api.reaktif.live/order2/getOrderNote',
            type: 'post',
            data: {
                "token": mtoken,
                "OrderCode": TS
            },
            headers: {
                'Accept': 'json'
            },
            dataType: 'json',
            success: function(resp) {
                $.spinPasif();
                if (resp.success) {

                    var tb1 = `
						<p style="text-align:left">Kullanıcı Notları</p>
						<table class="table table-striped table-hover table-bordered tbl_notes" style="font-size:12px;float:left; text-align:left">
								<thead>
									<tr style="background-color:#ccc">
									<th class ="col-md-2">Ekleyen</th>
									<th class ="col-md-10">Not</th>
									</tr>
								</thead>
								<tbody>
					`;

                    var tb2 = `
						<p style="text-align:left">Sistem Logları</p>
						<table class="table table-striped table-hover table-bordered tbl_notes" style="font-size:12px;float:left; text-align:left">
								<thead>
									<tr style="background-color:#ccc">
									<th class ="col-md-2">Ekleyen</th>
									<th class ="col-md-10">Not</th>
									</tr>
								</thead>
								<tbody>
					`;
                    //var appText ='<pre style="text-align : left; width:600px; overflow:auto">';
                    var appText = '';
                    var appText2 = '';
                    var notes = resp.data;

                    notes.sort(function(a, b) {
                        return Number(b.RecordTime) - Number(a.RecordTime)
                    });

                    for (i in notes) {
                        var obj = notes[i];
                        if (obj.IsNote == "1") {
                            appText += `
								<tr>
									<td>${ $.timeToString(obj.RecordTime) }<br>${obj.AdminName}</td>
									<td>${obj.Text}</td>
								</tr>
							`;
                        } else {
                            appText2 += `
								<tr>
									<td>${ $.timeToString(obj.RecordTime) }<br>${obj.AdminName}</td>
									<td>${obj.Text}</td>
								</tr>
							`;
                        }

                    }

                    tb1 += appText + '</tbody></table>';
                    tb2 += appText2 + '</tbody></table>';

                    $.sweetModal(tb1 + tb2);
                } else {
                    $.sweetModal('Sipariş bulunamadı, arşivde olabilir. <br><br> Hata Mesajı : ' + resp
                        .message[0].text[0]);
                }
            }, //success
            error: function(xhr) {
                $.spinPasif();
                $.sweetModal("xhr hatası.." + xhr.responseText);
            }
        });

    }
    $.timeToString=function(time){
        if(time == 0 || time == "null" || time == null) return "-";
        var time=Number(time)*1000;
        var tarih = new Date(time);
        var gun = tarih.getDate();
        var ay  = tarih.getMonth() + 1;
        var yil = tarih.getFullYear();

        var saat = tarih.getHours();
        var dakika = tarih.getMinutes();
        var saniye = tarih.getSeconds();

        if(gun<10) gun="0"+gun;
        if(ay<10) ay="0"+ay;

        if(saat<10) saat="0"+saat;
        if(dakika<10) dakika="0"+dakika;
        if(saniye<10) saniye="0"+saniye;

        // var zaman = gun+'-'+ay+'-'+yil+' '+saat+':'+dakika+':'+saniye;
        var zaman = yil+'-'+ay+'-'+gun+' '+saat+':'+dakika+':'+saniye;

        return zaman;
    }
    $.spinAktif = function() {
        $("#spinner_bg").removeClass("hide_this");
        $("#spinner").removeClass("hide_this");
    }

    $.spinPasif = function() {
        $("#spinner_bg").addClass("hide_this");
        $("#spinner").addClass("hide_this");
    }
</script>

</body>

</html>